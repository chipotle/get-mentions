const defaultConfig={likes:!0,reposts:!0,replies:!0,mentions:!0},refUrl=window.location.href.replace(/#.$/,""),apiUrl="https://webmention.io/api/",imagePlaceholder="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGAAAABgCAMAAADVRocKAAAAAXNSR0IArs4c6QAAAGBQTFRFkpKS/v7+k5OTh4eH/f39i4uLlZWV////kZGRlpaWhISEcHBwgYGB8fHxrKysSEhIAAAA6urqycnJ1tbW39/f+Pj4e3t7V1dXtbW1o6OjOTk5v7+/ZWVlmpqaKCgoBQUFhqYYcQAAAmdJREFUaN7tl0mSHSEMREFIpKDmef59/1t6UdVth72FjaPeATIDSWgw5uXl5eXl5eXlH4iIiHKJe1IREVHy6T2USMqo11bX2yVRyCfW91JufTcBlnnqhlokpNV3fuRqHMYKsAAwbtFrOgPvtqm7ms9nX7YKbBngtQzJHEg2Hpq9KEXi6SpYWAZSOriu25foA1G45hXWAoxJXKJMk1shbRnEkSqpqcAAGH0REmW4HKuvuqq6Q0gNxQEWAKMqHCV6QTU6wN5hD7GHBWABKRJlQSuewJYxnmRCPO5KZWxLGgOSu/otusV5/9ugbnyaLuFGMACLbi+9f0IERt0kyoHUADMzjtbRd5LBuBIZGHIHAKBrGiHV7nkP5iWVAcWrH4Z1/8zGu9o+ZdrtRbK2HeLSfNplViI3gO8IHW1JqZqFhqCiagzJzwOms5FkBkYNERmjJN33A+p2Tjtz1Bj945cN7SmpJ6d62aYnQOOniaSJDej5cpYx7vtskuPdAWvBFv3XPmtyfVKqwGDgaJsyx2Lkjlu/bpcc+oakg2UwtaejLPo1wJjmDPV5f+bYgzEVbSGkeQwGWGgu/dsAfXtm0n9CNO+59I16V6NrTp9J3xijOlXNHLIZqC8HFEU+A0NyYV2CyYePR71kvQG9FIVSvhCREykd5apTUlnHbjxEMzmQ3CvdKCZLlELsnwWyn0OWAOn3ZVMVOdr1z0JhYcscv+1PgzlHQyLz7HSMqilydDzvVsBaBtaES+9f1+wEAEe7ZJnJRn0Z67Uu2iXm6tdBzmZvCpdv4vgreDL5up1RvW+Fl5eXl5eXl5f/kF9OTiClUC4P7gAAAABJRU5ErkJggg==";let config={};window.addEventListener("load",async function(){const n=this.document.getElementById("webmentions");if(!n)return;Object.entries(defaultConfig).forEach(function([t,i]){n.hasAttribute(`data-${t}`)?config[t]=n.getAttribute(`data-${t}`)==="true":config[t]=i});const e=await getCounts(refUrl),s=await getAllMentions(e?.count,refUrl);let o=formatCounts(e);e.type.like&&config.likes&&(o+=`<div class="likes"><h2>Likes</h2>${formatLikes(s,"like-of")}</div>`),e.type.repost&&config.reposts&&(o+=`<div class="likes"><h2>Reposts</h2>${formatLikes(s,"repost-of")}</div>`),e.type.reply&&config.replies&&(o+=`<div class="replies"><h2>Replies</h2>${formatReplies(s,"in-reply-to")}</div>`),e.type.mention&&config.mentions&&(o+=`<div class="replies"><h2>Mentions</h2>${formatMentions(s,"mention-of")}</div>`),n.innerHTML=o});async function fetchResponse(n){let e={};try{const s=await fetch(apiUrl+n);if(!s.ok)throw new Error(`fetchResponse received HTTP status ${s.status}`);return e=s.json(),e}catch(s){console.error("Request failed:",s.message)}}async function getCounts(n){return fetchResponse("count?target="+n)}async function getAllMentions(n,e){return(await fetchResponse(`mentions.jf2?target=${e}&sort-by=published&sort-dir=up&per-page=${n}`))?.children}function formatCounts(n){const e=n.type.reply,s=n.type.mention,o=n.type.like,t=n.type.repost;let i="";if(o&&config.likes){const r=o>1?"Likes":"Like";i=`<span>${o} ${r}</span> `}if(t&&config.reposts){const r=t>1?"Reposts":"Repost";i+=`<span>${t} ${r}</span> `}if(e&&config.replies){const r=e>1?"Replies":"Reply";i+=`<span>${e} ${r}</span> `}if(s&&config.mentions){const r=s>1?"Mentions":"Mention";i+=`<span>${s} ${r}</span>`}return i?`<p class="mention-counts">${i}</p>`:""}function getMentions(n,e){return n.filter(o=>o["wm-property"]===e)}function formatLikes(n,e){const s=getMentions(n,e);let o="<ul>";return s.forEach(t=>{const i=t.author.name||t.author.url,r=t.author.photo||imagePlaceholder;o+=`<li><a href="${t.author.url}" title="${i}" rel="nofollow"><img src="${r}"></a></li>`}),`${o}</ul>`}function formatReplies(n,e){const s=getMentions(n,e);let o="<ul>";return s.forEach(t=>{const i=t.author.name||t.author.url,r=t.author.photo||imagePlaceholder;o+=`<li><a href="${t.url}" rel="nofollow"><img src="${r}"> <span class="author-name">${i}:</span></a> <span class="reply-text">${t.content.text}<span></li>`}),`${o}</ul>`}function formatMentions(n,e){const s=getMentions(n,e);let o="<ul>";return s.forEach(t=>{const i=t.author.name||t.author.url,r=t.author.photo||imagePlaceholder,a=t.summary.value||t.content.text.replace(/\s+/g," ").split(" ",50)+"&hellip;";o+=`<li><a href="${t.url}" rel="nofollow"><img src="${r}"> <span class="author-name">${i}:</span></a> <span class="reply-text">${a}<span></li>`}),`${o}</ul>`}
