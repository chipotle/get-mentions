const defaultConfig={likes:!0,reposts:!0,replies:!0,mentions:!0},refUrl=window.location.href.replace(/#.$/,""),apiUrl="https://webmention.io/api/",imagePlaceholder="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGAAAABgCAMAAADVRocKAAAAAXNSR0IArs4c6QAAAGBQTFRFkpKS/v7+k5OTh4eH/f39i4uLlZWV////kZGRlpaWhISEcHBwgYGB8fHxrKysSEhIAAAA6urqycnJ1tbW39/f+Pj4e3t7V1dXtbW1o6OjOTk5v7+/ZWVlmpqaKCgoBQUFhqYYcQAAAmdJREFUaN7tl0mSHSEMREFIpKDmef59/1t6UdVth72FjaPeATIDSWgw5uXl5eXl5eXlH4iIiHKJe1IREVHy6T2USMqo11bX2yVRyCfW91JufTcBlnnqhlokpNV3fuRqHMYKsAAwbtFrOgPvtqm7ms9nX7YKbBngtQzJHEg2Hpq9KEXi6SpYWAZSOriu25foA1G45hXWAoxJXKJMk1shbRnEkSqpqcAAGH0REmW4HKuvuqq6Q0gNxQEWAKMqHCV6QTU6wN5hD7GHBWABKRJlQSuewJYxnmRCPO5KZWxLGgOSu/otusV5/9ugbnyaLuFGMACLbi+9f0IERt0kyoHUADMzjtbRd5LBuBIZGHIHAKBrGiHV7nkP5iWVAcWrH4Z1/8zGu9o+ZdrtRbK2HeLSfNplViI3gO8IHW1JqZqFhqCiagzJzwOms5FkBkYNERmjJN33A+p2Tjtz1Bj945cN7SmpJ6d62aYnQOOniaSJDej5cpYx7vtskuPdAWvBFv3XPmtyfVKqwGDgaJsyx2Lkjlu/bpcc+oakg2UwtaejLPo1wJjmDPV5f+bYgzEVbSGkeQwGWGgu/dsAfXtm0n9CNO+59I16V6NrTp9J3xijOlXNHLIZqC8HFEU+A0NyYV2CyYePR71kvQG9FIVSvhCREykd5apTUlnHbjxEMzmQ3CvdKCZLlELsnwWyn0OWAOn3ZVMVOdr1z0JhYcscv+1PgzlHQyLz7HSMqilydDzvVsBaBtaES+9f1+wEAEe7ZJnJRn0Z67Uu2iXm6tdBzmZvCpdv4vgreDL5up1RvW+Fl5eXl5eXl5f/kF9OTiClUC4P7gAAAABJRU5ErkJggg==";let config={};window.addEventListener("load",async function(){const e=this.document.getElementById("webmentions");if(!e)return;Object.entries(defaultConfig).forEach(function([s,i]){e.hasAttribute(`data-${s}`)?config[s]=e.getAttribute(`data-${s}`)==="true":config[s]=i});const t=await getCounts(refUrl),n=await getAllMentions(t?.count,refUrl);let o=formatCounts(t);t.type.like&&config.likes&&(o+=`<div class="likes"><h2>Likes</h2>${formatLikes(n,"like-of")}</div>`),t.type.repost&&config.reposts&&(o+=`<div class="likes"><h2>Reposts</h2>${formatLikes(n,"repost-of")}</div>`),t.type.reply&&config.replies&&(o+=`<div class="replies"><h2>Replies</h2>${formatReplies(n,"in-reply-to")}</div>`),t.type.mention&&config.mentions&&(o+=`<div class="replies"><h2>Mentions</h2>${formatReplies(n,"mention-of")}</div>`),e.innerHTML=o});async function fetchResponse(e){let t={};try{const n=await fetch(apiUrl+e);if(!n.ok)throw new Error(`fetchResponse received HTTP status ${n.status}`);return t=n.json(),t}catch(n){console.error("Request failed:",n.message)}}async function getCounts(e){return fetchResponse("count?target="+e)}async function getAllMentions(e,t){return(await fetchResponse(`mentions.jf2?target=${t}&sort-by=published&sort-dir=up&per-page=${e}`))?.children}function formatCounts(e){const t=e.type.reply,n=e.type.mention,o=e.type.like,s=e.type.repost;let i="";if(o&&config.likes){const r=o>1?"Likes":"Like";i=`<span>${o} ${r}</span> `}if(s&&config.reposts){const r=s>1?"Reposts":"Repost";i+=`<span>${s} ${r}</span> `}if(t&&config.replies){const r=t>1?"Replies":"Reply";i+=`<span>${t} ${r}</span> `}if(n&&config.mentions){const r=n>1?"Mentions":"Mention";i+=`<span>${n} ${r}</span>`}return i?`<p class="mention-counts">${i}</p>`:""}function getMentions(e,t){return e.filter(o=>o["wm-property"]===t)}function formatLikes(e,t){const n=getMentions(e,t);let o="<ul>";return n.forEach(s=>{const i=s.author.name||s.author.url,r=s.author.photo||imagePlaceholder;o+=`<li><a href="${s.author.url}" title="${i}" rel="nofollow"><img src="${r}"></a></li>`}),`${o}</ul>`}function formatReplies(e,t){const n=getMentions(e,t);let o="<ul>";return n.forEach(s=>{const i=s.author.name||s.author.url,r=s.author.photo||imagePlaceholder;o+=`<li><a href="${s.url}" rel="nofollow"><img src="${r}"> <span class="author-name">${i}:</span></a> <span class="reply-text">${s.content.text}<span></li>`}),`${o}</ul>`}
